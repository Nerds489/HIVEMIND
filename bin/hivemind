#!/usr/bin/env bash
#===============================================================================
# HIVEMIND v2.0 - TUI Launcher
# Multi-Agent AI Orchestration System
#===============================================================================

set -euo pipefail

VERSION="2.0.0"
CODENAME="MINIMAL_OUTPUT"
SCRIPT_DIR="$(dirname "$(readlink -f "$0")")"
HIVEMIND_HOME="${HIVEMIND_HOME:-$(dirname "$SCRIPT_DIR")}"
TUI_DIR="${HIVEMIND_HOME}/tui"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
MAGENTA='\033[0;35m'
NC='\033[0m'
BOLD='\033[1m'

#===============================================================================
# BANNER
#===============================================================================
show_banner() {
    echo -e "${MAGENTA}"
    cat << 'EOF'
██╗  ██╗██╗██╗   ██╗███████╗███╗   ███╗██╗███╗   ██╗██████╗
██║  ██║██║██║   ██║██╔════╝████╗ ████║██║████╗  ██║██╔══██╗
███████║██║██║   ██║█████╗  ██╔████╔██║██║██╔██╗ ██║██║  ██║
██╔══██║██║╚██╗ ██╔╝██╔══╝  ██║╚██╔╝██║██║██║╚██╗██║██║  ██║
██║  ██║██║ ╚████╔╝ ███████╗██║ ╚═╝ ██║██║██║ ╚████║██████╔╝
╚═╝  ╚═╝╚═╝  ╚═══╝  ╚══════╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚═════╝
EOF
    echo -e "${NC}"
    echo -e "${CYAN}            v${VERSION} - ${CODENAME}${NC}"
    echo -e "${YELLOW}    24 Agents • 4 Teams • Minimal Output${NC}"
    echo ""
}

#===============================================================================
# HELP
#===============================================================================
show_help() {
    echo -e "${BOLD}Usage:${NC}"
    echo "  hivemind              Launch TUI interface"
    echo "  hivemind --tui        Launch TUI interface (explicit)"
    echo "  hivemind --version    Show version"
    echo "  hivemind --agents     List all agents"
    echo "  hivemind --status     Show system status"
    echo "  hivemind --help       Show this help"
    echo ""
    echo -e "${BOLD}Shortcuts:${NC}"
    echo "  hm                    Alias for hivemind"
}

#===============================================================================
# LIST AGENTS
#===============================================================================
list_agents() {
    echo -e "${BOLD}${CYAN}DEVELOPMENT TEAM${NC}"
    echo "  DEV-001  Architect"
    echo "  DEV-002  Backend Developer"
    echo "  DEV-003  Frontend Developer"
    echo "  DEV-004  Code Reviewer"
    echo "  DEV-005  Technical Writer"
    echo "  DEV-006  DevOps Liaison"
    echo ""
    echo -e "${BOLD}${RED}SECURITY TEAM${NC}"
    echo "  SEC-001  Security Architect"
    echo "  SEC-002  Penetration Tester"
    echo "  SEC-003  Malware Analyst"
    echo "  SEC-004  Wireless Security Expert"
    echo "  SEC-005  Compliance Auditor"
    echo "  SEC-006  Incident Responder"
    echo ""
    echo -e "${BOLD}${GREEN}INFRASTRUCTURE TEAM${NC}"
    echo "  INF-001  Infrastructure Architect"
    echo "  INF-002  Systems Administrator"
    echo "  INF-003  Network Engineer"
    echo "  INF-004  Database Administrator"
    echo "  INF-005  Site Reliability Engineer"
    echo "  INF-006  Automation Engineer"
    echo ""
    echo -e "${BOLD}${YELLOW}QA TEAM${NC}"
    echo "  QA-001   QA Architect"
    echo "  QA-002   Test Automation Engineer"
    echo "  QA-003   Performance Tester"
    echo "  QA-004   Security Tester"
    echo "  QA-005   Manual QA Tester"
    echo "  QA-006   Test Data Manager"
}

#===============================================================================
# STATUS
#===============================================================================
show_status() {
    echo -e "${BOLD}HIVEMIND STATUS${NC}"
    echo "  Version: ${VERSION}"
    echo "  Codename: ${CODENAME}"
    echo "  Home: ${HIVEMIND_HOME}"
    echo "  TUI: ${TUI_DIR}"
    echo "  Agents: 24"
    echo "  Teams: 4"
    echo "  Output Mode: Minimal (2-4 words)"
    echo "  Orchestrator: HEAD_CODEX"
}

#===============================================================================
# LAUNCH TUI
#===============================================================================
launch_tui() {
    if [[ ! -d "${TUI_DIR}" ]]; then
        echo -e "${RED}[ERROR]${NC} TUI directory not found: ${TUI_DIR}"
        exit 1
    fi

    if [[ ! -f "${TUI_DIR}/src/hivemind_tui/__main__.py" ]]; then
        echo -e "${RED}[ERROR]${NC} TUI module not found"
        exit 1
    fi

    # Launch the TUI
    cd "${TUI_DIR}"
    exec python -m hivemind_tui "$@"
}

#===============================================================================
# MAIN
#===============================================================================
main() {
    case "${1:-}" in
        --help|-h)
            show_banner
            show_help
            ;;
        --version|-v)
            echo "HIVEMIND v${VERSION} (${CODENAME})"
            ;;
        --status)
            show_status
            ;;
        --agents)
            list_agents
            ;;
        --tui)
            shift
            launch_tui "$@"
            ;;
        "")
            # Default: Launch TUI
            launch_tui
            ;;
        *)
            # Any other args: Launch TUI with args
            launch_tui "$@"
            ;;
    esac
}

main "$@"
