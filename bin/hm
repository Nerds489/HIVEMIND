#!/bin/bash
#
# hm - convenience wrapper around ./hivemind
#
# Usage:
#   hm "<task>"
#   hm status|config|help
#   hm agents
#   hm orchestrate "<task>" <agent...>
#   hm memory <subcommand> ...
#   hm test
#   hm kill

set -euo pipefail

HIVEMIND_ROOT="${HIVEMIND_ROOT:-$(dirname "$(dirname "$(realpath "$0")")")}"

main() {
  local cmd="${1:-}"
  case "$cmd" in
    ""|-h|--help|help)
      cat <<'EOF'
hm - HIVEMIND launcher

USAGE:
  hm "<task>"                      Run a task (interactive engine)
  hm status                        Show system status
  hm config                        Show engine configuration
  hm setup                         Authenticate engines (browser/API key)
  hm agents                        List available agent types
  hm orchestrate "<task>" a1 a2    Run multi-agent orchestration
  hm memory <args...>              Call memory-ops
  hm test                          Run system tests
  hm kill                          Terminate spawned agents (best-effort)
EOF
      ;;
    status)
      exec "$HIVEMIND_ROOT/hivemind" --status
      ;;
    config)
      exec "$HIVEMIND_ROOT/hivemind" --config
      ;;
    setup)
      exec "$HIVEMIND_ROOT/hivemind" --setup
      ;;
    agents)
      exec "$HIVEMIND_ROOT/bin/list-agents"
      ;;
    orchestrate)
      shift || true
      exec "$HIVEMIND_ROOT/bin/orchestrate" "$@"
      ;;
    memory)
      shift || true
      exec "$HIVEMIND_ROOT/bin/memory-ops" "$@"
      ;;
    test)
      exec "$HIVEMIND_ROOT/bin/test-hivemind"
      ;;
    kill)
      exec "$HIVEMIND_ROOT/bin/kill-agents"
      ;;
    *)
      exec "$HIVEMIND_ROOT/hivemind" "$@"
      ;;
  esac
}

main "$@"
